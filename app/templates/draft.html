<!DOCTYPE html>
<html>
  <head>
    <title>Football Draft Optimizer</title>
  </head>
  <body>
    <div
      style="
        float: left;
        width: 30%;
        border-right: 1px solid black;
        padding-right: 10px;
      "
    >
      <h2>Drafted Players</h2>
      <ul id="draftedPlayersList">
        <!-- This list will be populated using JavaScript -->
      </ul>
    </div>

    <div style="float: right; width: 65%">
      <button onclick="optimizePlayers()">Optimize</button>
      <h2>Available Players</h2>
      <table border="1">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Value Over Next Round</th>
            <th>ADP</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for player in players.itertuples() %}
          <tr id="player-{{ player.name.replace(' ', '-') }}">
            <td>{{ player.name }}</td>
            <td>{{ player.pos }}</td>
            <td>{{ player.valueOverNextRound }}</td>
            <td>{{ player.ADP }}</td>
            <td>
              <button onclick="selectPlayer('{{ player.name }}')">
                Select
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <script>
      function selectPlayer(name) {
        // Remove the player row from the available players table
        let playerNameId = "player-" + name.replace(/\s+/g, "-");
        let playerElement = document.getElementById(playerNameId);
        if (playerElement) {
          playerElement.remove();
        }

        // Add player to the drafted list
        let list = document.getElementById("draftedPlayersList");
        let item = document.createElement("li");
        item.appendChild(document.createTextNode(name));
        list.appendChild(item);

        // Send an AJAX request to update the server-side data
        fetch(`/select_player?name=${name}`, {
          method: "POST",
        }).then((response) => {
          if (response.ok) {
            console.log("player drafted");
          }
        });
      }

      function optimizePlayers() {
        // Make an AJAX request
        fetch("/get_optimized_players")
          .then((response) => response.json())
          .then((data) => {
            // Clear the existing table rows
            let tableBody = document.querySelector("tbody");
            tableBody.innerHTML = "";

            // Populate the table with the new data
            data.forEach((player) => {
              let row = document.createElement("tr");
              row.setAttribute(
                "id",
                "player-" + player.name.replace(/\s+/g, "-")
              );

              // Add player data to the row
              ["name", "pos", "valueOverNextRound", "ADP"].forEach((key) => {
                let cell = document.createElement("td");
                cell.textContent = player[key];
                row.appendChild(cell);
              });

              // Add the "Select" button
              let cell = document.createElement("td");
              let button = document.createElement("button");
              button.textContent = "Select";
              button.setAttribute("onclick", `selectPlayer('${player.name}')`);
              cell.appendChild(button);
              row.appendChild(cell);

              // Append the row to the table
              tableBody.appendChild(row);
            });
          });
      }
    </script>
  </body>
</html>
